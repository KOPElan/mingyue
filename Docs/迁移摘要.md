# MingYue è¿ç§»æ‘˜è¦
## QingFeng â†’ MingYue å¿«é€Ÿå‚è€ƒ

> ğŸ“Œ è¿™æ˜¯è¿ç§»è®¡åˆ’çš„ç®€åŒ–ç‰ˆæœ¬ï¼Œå®Œæ•´æ–‡æ¡£è¯·å‚é˜… [MIGRATION_PLAN.md](./MIGRATION_PLAN.md)

---

## ğŸ¯ è¿ç§»ç›®æ ‡

å°† **KOPElan/qingfeng** ä»“åº“çš„æ‰€æœ‰åŠŸèƒ½è¿ç§»åˆ° **MingYue**ï¼Œå¹¶ä½¿ç”¨ FluentUI Blazor è¿›è¡Œç°ä»£åŒ–é‡æ„ã€‚

---

## ğŸ“Š å½“å‰çŠ¶æ€å¯¹æ¯”

### MingYueï¼ˆç›®æ ‡é¡¹ç›®ï¼‰- å·²æœ‰åŠŸèƒ½ âœ…

| åŠŸèƒ½æ¨¡å— | çŠ¶æ€ | è¯´æ˜ |
|---------|------|------|
| ç³»ç»Ÿç›‘æ§ | âœ… å·²å®ç° | CPUã€å†…å­˜ã€ç½‘ç»œã€ç£ç›˜ç›‘æ§ |
| æ–‡ä»¶ç®¡ç†æœåŠ¡ | âœ… å·²å®ç° | å®Œæ•´çš„æ–‡ä»¶ CRUD æ“ä½œ |
| ç£ç›˜ç®¡ç†æœåŠ¡ | âœ… å·²å®ç° | æŒ‚è½½ã€ç½‘ç»œç£ç›˜ã€ç”µæºç®¡ç† |
| å…±äº«ç®¡ç†æœåŠ¡ | âœ… å·²å®ç° | Samba/NFS é…ç½® |
| Docker æœåŠ¡ | âœ… åŸºç¡€å®ç° | éœ€å®Œå–„ UI å’ŒåŠŸèƒ½ |
| æ•°æ®åº“ | âœ… å·²é…ç½® | SQLite + EF Core |
| UI æ¡†æ¶ | âœ… å·²é…ç½® | FluentUI Blazor |

### QingFengï¼ˆæºé¡¹ç›®ï¼‰- å®Œæ•´åŠŸèƒ½æ¸…å• ğŸ“‹

**æœåŠ¡å±‚ï¼ˆ38ä¸ªæœåŠ¡ï¼‰**:
```
âœ… å·²æœ‰: SystemMonitorService, FileManagerService, DiskManagementService, 
        ShareManagementService, DockerService

âŒ å¾…è¿ç§»:
   è®¤è¯ç›¸å…³ (2ä¸ª): AuthenticationService, AuthenticationStateService
   åº”ç”¨ç®¡ç† (2ä¸ª): ApplicationService, DockItemService
   ç³»ç»Ÿé…ç½® (2ä¸ª): SystemSettingService, LocalizationService
   ç»ˆç«¯ç›¸å…³ (1ä¸ª): TerminalService + TerminalHub
   ç½‘ç»œç®¡ç† (1ä¸ª): NetworkManagementService
   æ–‡ä»¶å¢å¼º (3ä¸ª): FileUploadService, ThumbnailService, FileIndexService
   Anydrop (1ä¸ª): AnydropService
   è®¡åˆ’ä»»åŠ¡ (3ä¸ª): ScheduledTaskService, ExecutionHistoryService, ExecutorService
   é€šçŸ¥ç³»ç»Ÿ (1ä¸ª): NotificationService (æ–°å¢)
```

**é¡µé¢ç»„ä»¶ï¼ˆ17ä¸ªé¡µé¢ï¼‰**:
```
âœ… å·²æœ‰: Home.razor (åŸºç¡€), SystemMonitor.razor (åŸºç¡€), Error.razor, NotFound.razor

âŒ å¾…è¿ç§» (13ä¸ª):
   - Login.razor, InitialSetup.razor (è®¤è¯)
   - AppManagement.razor, DockManagement.razor (åº”ç”¨ç®¡ç†)
   - Docker.razor (å®Œæ•´UI), FileManager.razor (å®Œæ•´UI)
   - DiskManagement.razor, ShareManagement.razor (å®Œæ•´UI)
   - WebTerminal.razor (ç»ˆç«¯)
   - Anydrop.razor (æ–‡ä»¶ä¼ è¾“)
   - ScheduledTasks.razor (ä»»åŠ¡)
   - Settings.razor, UserManagement.razor (è®¾ç½®)
```

**API ç«¯ç‚¹**:
```
âŒ å¾…è¿ç§»: AuthenticationEndpoints, ApplicationEndpoints, DockItemEndpoints,
          TerminalEndpoints, AnydropEndpoints, ScheduledTaskEndpoints,
          SystemSettingEndpoints, NotificationEndpoints (æ–°å¢)
```

---

## ğŸ“… è¿ç§»æ—¶é—´è¡¨ï¼ˆ10å‘¨è®¡åˆ’ï¼‰

### ç¬¬1-2å‘¨ï¼šæ ¸å¿ƒåŸºç¡€è®¾æ–½ ğŸ—ï¸
**ä¼˜å…ˆçº§**: P0 - å¿…é¡»å®Œæˆ

- [ ] **ç”¨æˆ·è®¤è¯ç³»ç»Ÿ**
  - æ•°æ®åº“: User è¡¨
  - æœåŠ¡: AuthenticationService, AuthenticationStateService
  - é¡µé¢: Login.razor, InitialSetup.razor, UserManagement.razor
  - API: AuthenticationEndpoints

- [ ] **åº”ç”¨å’Œ Dock ç®¡ç†**
  - æ•°æ®åº“: Application, DockItem è¡¨
  - æœåŠ¡: ApplicationService, DockItemService
  - é¡µé¢: AppManagement.razor, DockManagement.razor
  - API: ApplicationEndpoints, DockItemEndpoints

- [ ] **ä¸»é¡µé‡æ„**
  - å¢å¼º Home.razorï¼ˆåº”ç”¨ç½‘æ ¼ã€Dockæ ã€å¿«æ·æ–¹å¼ï¼‰

### ç¬¬3-5å‘¨ï¼šä¸»è¦åŠŸèƒ½è¿ç§» ğŸ’¼
**ä¼˜å…ˆçº§**: P1 - é‡è¦åŠŸèƒ½

- [ ] **æ–‡ä»¶ç®¡ç†å™¨å®Œæ•´ UI**
  - æœåŠ¡: FileUploadService, ThumbnailService, FileIndexService
  - é¡µé¢: FileManager.razorï¼ˆå®Œæ•´UIï¼‰
  - åŠŸèƒ½: æ–‡ä»¶é¢„è§ˆï¼ˆPDF/Word/Excelï¼‰ã€æ‹–æ‹½ä¸Šä¼ ã€ç¼©ç•¥å›¾

- [ ] **Docker ç®¡ç†å¢å¼º**
  - å®Œå–„ DockerService
  - å®Œæ•´ Docker.razor UI
  - å®¹å™¨æ—¥å¿—æŸ¥çœ‹

- [ ] **ç£ç›˜å’Œå…±äº«ç®¡ç† UI**
  - å®Œæ•´ DiskManagement.razor
  - å®Œæ•´ ShareManagement.razor
  - æŒ‚è½½å‘å¯¼

### ç¬¬6-8å‘¨ï¼šé«˜çº§åŠŸèƒ½è¿ç§» ğŸš€
**ä¼˜å…ˆçº§**: P2 - é«˜çº§åŠŸèƒ½

- [ ] **Web ç»ˆç«¯**
  - æœåŠ¡: TerminalService
  - Hub: TerminalHub (SignalR)
  - é¡µé¢: WebTerminal.razor
  - ä¾èµ–: xterm.js

- [ ] **Anydrop æ–‡ä»¶ä¼ è¾“**
  - æ•°æ®åº“: AnydropMessage, AnydropAttachment è¡¨
  - æœåŠ¡: AnydropService
  - é¡µé¢: Anydrop.razor
  - API: AnydropEndpoints

- [ ] **è®¡åˆ’ä»»åŠ¡**
  - æ•°æ®åº“: ScheduledTask, ExecutionHistory è¡¨
  - æœåŠ¡: ScheduledTaskService, ExecutorService
  - é¡µé¢: ScheduledTasks.razor
  - åŠŸèƒ½: Cron è°ƒåº¦ã€æ‰§è¡Œå†å²

- [ ] **ç³»ç»Ÿè®¾ç½®**
  - æ•°æ®åº“: SystemSetting è¡¨
  - æœåŠ¡: SystemSettingService
  - é¡µé¢: Settings.razor

- [ ] **é€šçŸ¥æœåŠ¡**ï¼ˆæ–°å¢ï¼‰
  - æ•°æ®åº“: Notification è¡¨
  - æœåŠ¡: NotificationService
  - ç»„ä»¶: é€šçŸ¥é¢æ¿ï¼ˆMainLayout é›†æˆï¼‰
  - API: NotificationEndpoints
  - åŠŸèƒ½: å®æ—¶é€šçŸ¥ã€æœªè¯»è®¡æ•°ã€æ‰¹é‡æ“ä½œ

### ç¬¬9-10å‘¨ï¼šä¼˜åŒ–å’Œå®Œå–„ âœ¨
**ä¼˜å…ˆçº§**: P3 - ä¼˜åŒ–å®Œå–„

- [ ] **æœ¬åœ°åŒ–**
  - æœåŠ¡: LocalizationService
  - èµ„æºæ–‡ä»¶ï¼ˆä¸­æ–‡/è‹±æ–‡ï¼‰
  - è¯­è¨€åˆ‡æ¢

- [ ] **ç½‘ç»œç®¡ç†**
  - æœåŠ¡: NetworkManagementService
  - ç½‘ç»œé…ç½®é¡µé¢

- [ ] **æ€§èƒ½ä¼˜åŒ–**
  - æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–
  - è™šæ‹ŸåŒ–é•¿åˆ—è¡¨
  - ç¼“å­˜ç­–ç•¥
  - é™æ€èµ„æºä¼˜åŒ–

- [ ] **æµ‹è¯•å’Œæ–‡æ¡£**
  - å•å…ƒæµ‹è¯•ï¼ˆç›®æ ‡ >70% è¦†ç›–ç‡ï¼‰
  - bUnit ç»„ä»¶æµ‹è¯•
  - API æ–‡æ¡£
  - ç”¨æˆ·æŒ‡å—

---

## ğŸ”‘ å…³é”®æŠ€æœ¯ç‚¹

### 1ï¸âƒ£ FluentUI Blazor è¿ç§»

QingFeng ä½¿ç”¨ **MudBlazor** â†’ MingYue ä½¿ç”¨ **FluentUI Blazor**

**å¸¸è§ç»„ä»¶å¯¹åº”å…³ç³»**:
```csharp
// MudBlazor â†’ FluentUI Blazor
MudButton          â†’ FluentButton
MudTextField       â†’ FluentTextField
MudTable           â†’ FluentDataGrid
MudDialog          â†’ FluentDialog
MudIcon            â†’ FluentIcon
MudPaper           â†’ FluentCard
MudGrid/MudItem    â†’ FluentGrid/FluentGridItem
```

**æœ€ä½³å®è·µ**:
- ä½¿ç”¨ `FluentDesignTheme` ç®¡ç†ä¸»é¢˜
- ä½¿ç”¨ Providerï¼ˆToast, Dialog, Tooltipï¼‰
- è¡¨å•éªŒè¯ä½¿ç”¨ `EditForm` + `DataAnnotationsValidator`
- å¤§æ•°æ®è¡¨æ ¼å¯ç”¨ `Virtualize="true"`

### 2ï¸âƒ£ æ•°æ®åº“æ¶æ„å‡çº§

**éœ€è¦æ¿€æ´»çš„è¡¨**:
```csharp
// å½“å‰åªæœ‰ FavoriteFolder æ¿€æ´»ï¼Œéœ€è¦å¯ç”¨ï¼š
- User                        // ç”¨æˆ·è®¤è¯
- Application, DockItem       // åº”ç”¨ç®¡ç†
- SystemSetting               // ç³»ç»Ÿé…ç½®
- ScheduledTask, ExecutionHistory  // è®¡åˆ’ä»»åŠ¡
- AnydropMessage, AnydropAttachment  // Anydrop
- FileIndex, Thumbnail        // æ–‡ä»¶ç´¢å¼•
```

**è¿ç§»å‘½ä»¤**:
```bash
dotnet ef migrations add EnableCoreEntities
dotnet ef database update
```

### 3ï¸âƒ£ å®‰å…¨æ€§é‡æ„

**å¯†ç å­˜å‚¨**:
```csharp
// ä½¿ç”¨ BCrypt å“ˆå¸Œ
using BCrypt.Net;

string hash = BCrypt.HashPassword(password);
bool verified = BCrypt.Verify(password, hash);
```

**è¾“å…¥éªŒè¯**:
```csharp
// è·¯å¾„éªŒè¯
public bool IsPathSafe(string path)
{
    var normalized = Path.GetFullPath(path);
    return normalized.StartsWith(allowedRoot);
}

// Shell å‚æ•°è½¬ä¹‰
public string EscapeShellArgument(string arg)
{
    return $"\"{arg.Replace("\"", "\\\"")}\"";
}
```

### 4ï¸âƒ£ æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

1. **è™šæ‹ŸåŒ–é•¿åˆ—è¡¨**
```razor
<FluentDataGrid Items="@items" Virtualize="true" ItemSize="50">
```

2. **å¼‚æ­¥æ•°æ®åŠ è½½**
```csharp
public async Task<List<T>> GetAsync()
{
    using var context = await _dbFactory.CreateDbContextAsync();
    return await context.Set<T>().AsNoTracking().ToListAsync();
}
```

3. **ç¼“å­˜ç­–ç•¥**
```csharp
// ç¼©ç•¥å›¾ç¼“å­˜ç¤ºä¾‹
private readonly MemoryCache _cache = new(...);
if (_cache.TryGetValue(key, out var cached)) return cached;
```

---

## ğŸ“‹ æ£€æŸ¥æ¸…å•æ¨¡æ¿

### Phase 1 å®Œæˆæ ‡å‡† âœ…

- [ ] User è¡¨å·²åˆ›å»ºå¹¶è¿ç§»
- [ ] å¯ä»¥æ³¨å†Œå’Œç™»å½•
- [ ] å¯†ç ä½¿ç”¨ BCrypt å“ˆå¸Œå­˜å‚¨
- [ ] Application å’Œ DockItem è¡¨å·²åˆ›å»º
- [ ] å¯ä»¥æ·»åŠ ã€ç¼–è¾‘ã€åˆ é™¤åº”ç”¨
- [ ] å¯ä»¥å›ºå®šåº”ç”¨åˆ° Dock
- [ ] ä¸»é¡µæ˜¾ç¤ºåº”ç”¨ç½‘æ ¼å’Œ Dock æ 
- [ ] ç¼–å†™äº†å•å…ƒæµ‹è¯•
- [ ] ä»£ç ç¬¦åˆ CODE_STYLE.md è§„èŒƒ

### Phase 2 å®Œæˆæ ‡å‡† âœ…

- [ ] FileManager.razor å®Œæ•´ UI å®ç°
- [ ] æ”¯æŒå›¾ç‰‡ã€PDFã€Wordã€Excel é¢„è§ˆ
- [ ] æ”¯æŒæ‹–æ‹½ä¸Šä¼ å¤šä¸ªæ–‡ä»¶
- [ ] ç¼©ç•¥å›¾ç”Ÿæˆå’Œç¼“å­˜
- [ ] Docker.razor å®Œæ•´ UI å®ç°
- [ ] å®¹å™¨æ—¥å¿—æŸ¥çœ‹åŠŸèƒ½
- [ ] DiskManagement.razor å’Œ ShareManagement.razor å®Œæ•´ UI
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–æ ¸å¿ƒæœåŠ¡

### Phase 3 å®Œæˆæ ‡å‡† âœ…

- [ ] WebTerminal.razor å¯ä»¥æ‰“å¼€æµè§ˆå™¨ç»ˆç«¯
- [ ] ç»ˆç«¯è¾“å…¥è¾“å‡ºæ­£å¸¸ï¼Œå®æ—¶é€šä¿¡
- [ ] Anydrop.razor å¯ä»¥å‘é€æ¶ˆæ¯å’Œæ–‡ä»¶
- [ ] ScheduledTasks.razor å¯ä»¥åˆ›å»ºå’Œç®¡ç†ä»»åŠ¡
- [ ] Cron è¡¨è¾¾å¼ç¼–è¾‘å™¨å·¥ä½œæ­£å¸¸
- [ ] Settings.razor å¯ä»¥ä¿®æ”¹ç³»ç»Ÿè®¾ç½®
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–æ–°åŠŸèƒ½

### Phase 4 å®Œæˆæ ‡å‡† âœ…

- [ ] æ”¯æŒä¸­è‹±æ–‡åˆ‡æ¢
- [ ] æ‰€æœ‰é¡µé¢å’Œç»„ä»¶å·²æœ¬åœ°åŒ–
- [ ] ç½‘ç»œç®¡ç†é¡µé¢å®ç°
- [ ] æ€§èƒ½æµ‹è¯•é€šè¿‡ï¼ˆé¦–é¡µ <2sï¼Œåˆ—è¡¨ <1sï¼‰
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡ >70%
- [ ] API æ–‡æ¡£å®Œæˆ
- [ ] ç”¨æˆ·æŒ‡å—å®Œæˆ

---

## ğŸš€ å¿«é€Ÿå¼€å§‹è¿ç§»

### 1. è®¾ç½®å¼€å‘ç¯å¢ƒ
```bash
# å…‹éš†ä»“åº“
git clone https://github.com/KOPElan/mingyue.git
cd mingyue/MingYue

# å®‰è£…ä¾èµ–
dotnet restore

# è¿è¡Œ
dotnet run
```

### 2. é˜…è¯»æ–‡æ¡£
- [CODE_STYLE.md](./CODE_STYLE.md) - ä»£ç è§„èŒƒ
- [FluentUI-Blazor-Guide.md](./FluentUI-Blazor-Guide.md) - UI æœ€ä½³å®è·µ
- [MIGRATION_PLAN.md](./MIGRATION_PLAN.md) - å®Œæ•´è¿ç§»è®¡åˆ’

### 3. å¼€å§‹ç¬¬ä¸€ä¸ªä»»åŠ¡
å»ºè®®ä» **Phase 1 çš„ç”¨æˆ·è®¤è¯** å¼€å§‹ï¼š

```bash
# åˆ›å»ºåˆ†æ”¯
git checkout -b feature/user-authentication

# 1. åˆ›å»º User æ•°æ®æ¨¡å‹
# 2. å®ç° AuthenticationService
# 3. åˆ›å»º Login.razor
# 4. æµ‹è¯•ç™»å½•æµç¨‹
```

---

## ğŸ“ è·å–å¸®åŠ©

- **é—®é¢˜**: [GitHub Issues](https://github.com/KOPElan/mingyue/issues)
- **è®¨è®º**: [GitHub Discussions](https://github.com/KOPElan/mingyue/discussions)
- **æºé¡¹ç›®**: [KOPElan/qingfeng](https://github.com/KOPElan/qingfeng)

---

**æœ€åæ›´æ–°**: 2026-01-21  
**æ–‡æ¡£ç‰ˆæœ¬**: 1.0
